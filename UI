local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local gui = Instance.new("ScreenGui")
gui.Name = "AutoInteractUI"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 240, 0, 150)
frame.Position = UDim2.new(0.34, 0, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 28)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
title.Text = "游戏悦制裁脚本snmwdd开发"
title.TextColor3 = Color3.new(1,1,1)
title.TextScaled = true
title.Font = Enum.Font.SourceSansBold
title.Parent = frame
Instance.new("UICorner", title).CornerRadius = UDim.new(0, 10)

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0.84, 0, 0, 40)
toggleBtn.Position = UDim2.new(0.08, 0, 0.30, 0)
toggleBtn.Text = "关闭"
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextScaled = true
toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
toggleBtn.Parent = frame
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

local rangeBox = Instance.new("TextBox")
rangeBox.Size = UDim2.new(0.84, 0, 0, 38)
rangeBox.Position = UDim2.new(0.08, 0, 0.70, 0)
rangeBox.Text = "15"
rangeBox.PlaceholderText = "范围"
rangeBox.ClearTextOnFocus = false
rangeBox.TextScaled = true
rangeBox.TextColor3 = Color3.new(1,1,1)
rangeBox.Font = Enum.Font.SourceSansBold
rangeBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
rangeBox.Parent = frame
Instance.new("UICorner", rangeBox).CornerRadius = UDim.new(0, 8)

local auto = false
local interactDistance = tonumber(rangeBox.Text) or 15
local lastFireAt = {}
local throttle = 0.15
local timeAcc = 0

rangeBox:GetPropertyChangedSignal("Text"):Connect(function()
    local filtered = rangeBox.Text:gsub("%D", "")
    if filtered == "" then filtered = "0" end
    if filtered ~= rangeBox.Text then
        local startPos = rangeBox.CursorPosition
        rangeBox.Text = filtered
        rangeBox.CursorPosition = math.min((startPos or #filtered), #filtered+1)
    end
end)

local function applyRangeFromBox()
    local v = tonumber(rangeBox.Text)
    if v and v > 0 then
        interactDistance = v
    else
        rangeBox.Text = tostring(interactDistance)
    end
end

rangeBox.FocusLost:Connect(function()
    applyRangeFromBox()
end)

toggleBtn.MouseButton1Click:Connect(function()
    auto = not auto
    if auto then
        toggleBtn.Text = "开启"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    else
        toggleBtn.Text = "关闭"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    end
end)

local function getPromptWorldPos(prompt)
    local parent = prompt.Parent
    if not parent then return nil end
    if parent:IsA("BasePart") then
        return parent.Position
    elseif parent:IsA("Attachment") then
        return parent.WorldPosition
    elseif parent:IsA("Model") then
        local pp = parent.PrimaryPart
        if pp then return pp.Position end
        local cf = parent:GetPivot()
        return cf.Position
    else
        local part = parent:FindFirstChildWhichIsA("BasePart", true)
        if part then return part.Position end
    end
    return nil
end

RunService.Heartbeat:Connect(function(dt)
    timeAcc += dt
    if not auto or timeAcc < throttle then return end
    timeAcc = 0

    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("ProximityPrompt") and obj.Enabled and obj.Parent then
            if obj.MaxActivationDistance < interactDistance then
                pcall(function() obj.MaxActivationDistance = interactDistance end)
            end

            local pos = getPromptWorldPos(obj)
            if pos then
                local dist = (pos - root.Position).Magnitude
                if dist <= interactDistance then
                    local now = os.clock()
                    if (lastFireAt[obj] or 0) + 0.6 < now then
                        lastFireAt[obj] = now
                        pcall(fireproximityprompt, obj)
                    end
                end
            end
        end
    end
end)
